# プロを目指す人のためのRuby 5章 ハッシュシンボルやシンボルを理解するのコラム

## （1） 条件分岐で変数に代入/&.演算子

#### 概略
+ 「nilかもしれないオブジェクトに対して安全にメソッドを呼び出したい」ときのイディオム

#### **結論**
* &.演算子を使う

#### 前提
* nilに対してupcaseなどのメソッドを呼び出すとエラーになる。 

```
a = nil
a.upcase
```

```
pg.rb:7:in `<main>': undefined method `upcase' for nil:NilClass (NoMethodError)

```

#### 対象方法
* これを **&.演算子** を使うことで安全に書ける

```
a = nil
a&.upcase #=> nil
```

## （2） ||= を使った自己代入(nilガード)

#### 概略

* 「ある変数がnilまたはfalseであれば、何かを代入したい」ときのイディオム

#### **結論**

* hoge || = 10　という書き方をする

#### 前提

* 論理演算子の || や && は式全体の真偽値が確定した事態で評価を終了する
* また、確定した時点でその時の値を戻り値を終了する→短絡評価

#### 対象方法

+ 短絡評価を利用する

```
hoge = nil
# hogeがnilなので hoge = 10 が実行される
hoge || hoge = 10
hoge #=> 10

hoge = 10
# hogeが真なので、式の評価が終了しhoge = 10が実行されることはない
hoge || hoge = 20
hoge #=> 10

```

## （3） !! を使った真偽値の型変換

#### 概略

* 「確実にtrue or falseを返したい」ときのイディオム

#### **結論**

* !!を使用する

#### 前提

* !は論理否定の演算子。
* !Aと書いたらAが真であればfalseを、偽であればtrueを返す
```
!地球は青かった #=> false
!地球は真四角だ #=> true
```
* ここで、必ずtrue or falseに変換できる。
* これをもう一度反転させると、正しい真偽値になる

```
!!地球は青かった #=> true
!!地球は真四角だ #=> false
```




